#!/usr/bin/env ruby

require 'net/http'

sheets = %w(1854354
1854393
1854394
1855548
1855833
1876222
1876637
1881898
1882070
1883091
1884212
1886447
1886668
1887242
1889293
1892825
1901770
1901780
1901810
1902207
1902249
1902801
1903041
1903056
1903159
1903725
1904465
1904606
1904870
1905818
1905962
1907213
1907554
1907942
1908055
1908210
1908657
1908658
1917896
1918718
1919216
1925387
1926288
1926437
1926578
1926953
1928346
1928354
1928497
1930477
1930556
1931319
1931333
1931383
1931418
1932334
1933589
1933700
1933722
1933748
1933967
1934199
1934350
1934436
1934600
1934602
1938043
1938878
1939228
1946088
1946242
1947527
1950684
1951961
1952474
1963028
1963336
1965235
1965240
1965286
1965449
1971159
1973976
1975865
1976666
1981109
1983570
1993776
1996378
1997408
1997552
1997697
2000528
2001670
2004473
2004553
2004744
2006168
2006292
2006294
2007668
2007742
2016267
2022033
2029380
2041900
2047408
2047469
2047530
2049229
2069743
2116604
2181528)

everydir = File.expand_path(__dir__ + "/..")
sheets.each do |sheet|
  downloaded_sheet = Net::HTTP.get(URI("https://www.everything2.com/?node_id=#{sheet}&displaytype=serve"))
  downloaded_sheet.gsub!(/\r/,'')
  downloaded_sheet.gsub!(/\s+$/,'')
  if(downloaded_sheet.match(/504 Service Unavailable/))
    puts "E2 offline?"
    exit 1
  end
  File.open("#{everydir}/www/css/#{sheet}.css","w"){|f| f.write downloaded_sheet}
  puts "Downloaded #{sheet}.css"
  sleep 1
end

